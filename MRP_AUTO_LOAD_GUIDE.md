# MRP 系統 - 自動讀取與期間控制指南

## 📋 系統概述

這個 MRP 系統現在具備以下新功能：
- **自動讀取**: 進入頁面時自動從 Google Sheets 讀取資料
- **期間控制**: 只能輸入當前期間，無法自動推進
- **初始化功能**: 可以初始化 Google Sheets 建立範例資料
- **直接操作**: 所有操作都直接與 Google Sheets 互動

## 🔗 Google Sheets 連結

**您的 Google Sheets**: https://docs.google.com/spreadsheets/d/1ieSa4W6_crSYoIobMiEACW2wG-PYb1PLTRFElhS5FoQ/edit?gid=655606014#gid=655606014

## 🚀 新功能說明

### 1. 自動讀取功能
- **頁面載入時自動讀取**: 系統會在進入頁面時自動從 Google Sheets 讀取資料
- **無需手動按鈕**: 不需要點擊「讀取資料」按鈕
- **自動初始化**: 如果 Google Sheets 沒有資料，系統會自動建立範例資料

### 2. 期間控制功能
- **只能輸入當前期間**: 使用者只能手動輸入當前期間
- **範圍限制**: 期間只能在 1-10 之間
- **即時更新**: 輸入期間後點擊「更新期間」即可查看該期間的結果
- **重置功能**: 可以重置期間回到第 1 期

### 3. 初始化功能
- **一鍵初始化**: 點擊「初始化 Google Sheets」即可建立完整的範例資料
- **範例資料**: 包含需求資料、BOM 結構、基本設定等
- **格式化**: 自動格式化所有工作表

### 4. 送出功能
- **直接寫入**: 點擊「送出結果」將 MRP 結果直接寫入 Google Sheets
- **自動格式化**: 結果會自動格式化並寫入 `MRP_Results` 工作表

## 📊 初始化後的資料結構

### Demand 工作表
```
期間    1    2    3    4    5    6    7    8    9    10
需求    0    0    0    0    4    0    0    0    0    4
```

### BOM 工作表
```
組件名稱    需求量    供應商    前置時間
Component A    2    Supplier A    2
Component B    1    Supplier B    1
```

### Settings 工作表
```
設定項目    數值
模擬期間數    10
成品名稱    Product A
期初庫存    1
當前期間    1
```

## 🎯 使用流程

### 1. 首次使用
1. **開啟系統**: 使用部署後的網頁應用程式 URL
2. **自動初始化**: 系統會自動檢查並初始化 Google Sheets
3. **自動讀取**: 系統會自動讀取資料並更新表單

### 2. 日常使用
1. **開啟系統**: 系統會自動讀取最新的 Google Sheets 資料
2. **查看當前期間**: 系統會顯示當前期間（預設為第 1 期）
3. **修改期間**: 在期間輸入框中輸入想要查看的期間（1-10）
4. **更新期間**: 點擊「更新期間」查看該期間的模擬結果
5. **執行模擬**: 點擊「執行 MRP 模擬」進行計算
6. **送出結果**: 點擊「送出結果」將結果寫入 Google Sheets

### 3. 重新初始化
如果需要重新開始或清除資料：
1. 點擊「初始化 Google Sheets」
2. 系統會清空並重新建立所有範例資料
3. 頁面會自動重新載入資料

## 📈 期間控制說明

### 期間輸入規則
- **範圍**: 只能輸入 1-10 之間的數字
- **驗證**: 系統會自動驗證輸入的期間是否有效
- **即時更新**: 輸入後點擊「更新期間」即可查看結果

### 期間顯示內容
每個期間會顯示：
- **成品需求**: 該期間的成品需求量
- **期初庫存**: 該期間開始時的庫存數量
- **庫存缺口**: 需求與庫存的差距
- **生產開始**: 該期間開始的生產數量
- **組件訂單**: 該期間的組件訂單需求

### 範例期間操作
1. **期間 1**: 需求 0，庫存 1，無缺口，無生產
2. **期間 5**: 需求 4，庫存 1，缺口 3，生產開始 3
3. **期間 10**: 需求 4，庫存 0，缺口 4，生產開始 4

## 🔧 系統特色

### ✅ 自動化操作
- **自動讀取**: 進入頁面時自動讀取 Google Sheets 資料
- **自動初始化**: 自動建立範例資料
- **自動格式化**: 自動格式化所有工作表

### ✅ 期間控制
- **手動輸入**: 只能手動輸入當前期間
- **範圍限制**: 期間限制在 1-10 之間
- **即時驗證**: 自動驗證期間輸入

### ✅ 直接操作
- **即時讀取**: 直接從 Google Sheets 讀取資料
- **即時寫入**: 計算結果直接寫入 Google Sheets
- **無需匯入匯出**: 所有操作都是直接與 Google Sheets 互動

## 🛠️ 故障排除

### 常見問題

#### 1. 頁面載入時沒有自動讀取資料
**解決方案**:
- 檢查瀏覽器控制台是否有錯誤訊息
- 確認 Google Sheets 的權限設定
- 點擊「初始化 Google Sheets」重新建立資料

#### 2. 期間輸入無效
**解決方案**:
- 確保輸入的是 1-10 之間的數字
- 檢查是否已執行 MRP 模擬
- 確認 Google Sheets 中有足夠的資料

#### 3. 無法送出結果
**解決方案**:
- 確保已執行 MRP 模擬
- 檢查 Google Sheets 的編輯權限
- 確認 Apps Script 的執行權限

### 除錯技巧

#### 1. 查看執行記錄
1. 在 Google Apps Script 編輯器中點擊「執行記錄」
2. 查看詳細的錯誤訊息

#### 2. 測試初始化
可以使用以下方式測試初始化：
```javascript
// 在 Google Apps Script 編輯器中測試
function testInitialization() {
  const result = initializeGoogleSheets();
  console.log(result);
}
```

#### 3. 檢查期間設定
可以使用以下方式檢查期間設定：
```javascript
// 在 Google Apps Script 編輯器中測試
function testPeriodSettings() {
  const result = getCurrentPeriod();
  console.log(result);
}
```

## 📞 支援

如有任何問題或需要協助，請：
1. 檢查本指南的故障排除章節
2. 查看 Google Apps Script 的執行記錄
3. 確認 Google Sheets 的權限設定
4. 嘗試重新初始化 Google Sheets

---

**版本**: 2.0  
**更新日期**: 2024年  
**開發者**: MRP System Team 