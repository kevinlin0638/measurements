# BOM 和 Measurements 資料輸入系統設置說明

## 📋 系統概述

這個系統包含兩個主要文件：
- `index.html` - 靜態網頁，用於輸入資料
- `gas-script.js` - Google Apps Script 代碼，用於處理資料提交

## 🚀 設置步驟

### 第一步：設置 Google Apps Script

1. **開啟 Google Apps Script**
   - 前往 [https://script.google.com/](https://script.google.com/)
   - 使用您的 Google 帳戶登入

2. **創建新專案**
   - 點擊「新增專案」
   - 將專案命名為「BOM-Measurements-API」

3. **貼入代碼**
   - 刪除預設的 `myFunction()` 代碼
   - 將 `gas-script.js` 文件中的所有代碼複製並貼入
   - 確認 `SPREADSHEET_ID` 已設置為您的 Google Sheets ID：
     ```javascript
     const SPREADSHEET_ID = '13RKGU7mhy-NaFkokHT87tSnPXp5ae0WC0tJjL0wOLKw';
     ```

4. **保存專案**
   - 按 `Ctrl+S` 或點擊「儲存」圖標
   - 專案會自動保存

### 第二步：初始化工作表（可選）

1. **執行初始化函數**
   - 在 Google Apps Script 編輯器中
   - 選擇函數：`initializeSheets`
   - 點擊「執行」按鈕
   - 如果出現授權提示，請允許所有權限

2. **驗證工作表**
   - 檢查您的 Google Sheets
   - 應該會看到兩個新的工作表：`bom` 和 `measurements`
   - 每個工作表都有適當的標題行

### 第三步：部署為 Web App

1. **開始部署**
   - 點擊「部署」→「新增部署作業」

2. **選擇類型**
   - 選擇「網頁應用程式」

3. **設置部署選項**
   - **說明**：輸入「BOM Measurements API v1」
   - **執行身分**：選擇「我」
   - **存取權**：選擇「所有人」

4. **部署**
   - 點擊「部署」
   - 如果出現授權提示，請允許所有權限

5. **獲取 Web App URL**
   - 複製提供的 Web App URL
   - 格式類似：`https://script.google.com/macros/s/AKfycbxxx.../exec`

### 第四步：設置 HTML 網頁

1. **編輯 index.html**
   - 打開 `index.html` 文件
   - 找到這行代碼：
     ```javascript
     const SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
     ```
   - 將 `YOUR_GOOGLE_APPS_SCRIPT_URL_HERE` 替換為步驟三中獲得的 Web App URL

2. **保存文件**
   - 保存 `index.html` 文件

## 🎯 使用方法

### 開啟網頁
- 雙擊 `index.html` 文件
- 或者在瀏覽器中打開該文件

### 輸入 BOM 資料
1. 填寫「零件編號」（必填）
2. 填寫「序列號」（必填）
3. 填寫「組裝序列號」（可選，最小零件可留空）
4. 點擊「提交 BOM 資料」

### 輸入 Measurements 資料
1. 填寫「序列號」（必填）
2. 填寫「參數名稱」（必填）
3. 填寫「參數值」（必填，數字）
4. 點擊「提交 Measurements 資料」

## 📊 資料結構

### BOM 表格結構
| 欄位 | 類型 | 說明 |
|------|------|------|
| id | 數字 | 自動生成的唯一 ID |
| part_no | 文字 | 零件編號 |
| serial_number | 文字 | 序列號 |
| assembly_serial_number | 文字 | 組裝序列號（可空） |
| created_at | 日期時間 | 建立時間 |

### Measurements 表格結構
| 欄位 | 類型 | 說明 |
|------|------|------|
| id | 數字 | 自動生成的唯一 ID |
| serial_number | 文字 | 序列號 |
| para_name | 文字 | 參數名稱 |
| para_value | 數字 | 參數值 |
| created_at | 日期時間 | 建立時間 |

## 🔧 測試

### 測試 Google Apps Script
1. 在 Google Apps Script 編輯器中
2. 選擇函數：`testScript`
3. 點擊「執行」
4. 檢查執行記錄，確認無錯誤
5. 檢查 Google Sheets，應該會看到測試資料

### 測試網頁
1. 開啟 `index.html`
2. 嘗試提交一筆 BOM 資料
3. 嘗試提交一筆 Measurements 資料
4. 檢查 Google Sheets，確認資料已正確新增

## 🚨 故障排除

### 常見問題

1. **「請先設定 Google Apps Script URL！」錯誤**
   - 檢查是否正確替換了 `SCRIPT_URL` 變數
   - 確認 URL 格式正確

2. **「提交失敗」錯誤**
   - 檢查網路連接
   - 確認 Google Apps Script 已正確部署
   - 檢查瀏覽器開發者工具中的錯誤訊息

3. **資料沒有出現在 Google Sheets**
   - 確認 Google Sheets ID 正確
   - 檢查工作表名稱是否為 `bom` 和 `measurements`
   - 確認 Google Apps Script 有權限存取 Google Sheets

4. **授權問題**
   - 重新部署 Google Apps Script
   - 確認存取權限設置為「所有人」

### 檢查步驟
1. **確認 Google Apps Script URL**
   - 訪問 Web App URL，應該看到 JSON 回應
   - 例如：`{"success":true,"message":"Google Apps Script 運行正常"}`

2. **檢查瀏覽器開發者工具**
   - 按 F12 開啟開發者工具
   - 查看 Console 和 Network 頁籤中的錯誤訊息

3. **檢查 Google Apps Script 執行記錄**
   - 在 Google Apps Script 編輯器中查看「執行」記錄
   - 查看是否有錯誤訊息

## 📝 注意事項

1. **一次只能提交一筆資料**
2. **建議在提交前先測試系統**
3. **定期備份您的 Google Sheets 資料**
4. **如需修改資料結構，請同時更新 HTML 和 Google Apps Script 代碼**

## 🔄 更新部署

如果您修改了 Google Apps Script 代碼：
1. 保存代碼
2. 點擊「部署」→「管理部署作業」
3. 點擊「編輯」圖標
4. 更新版本描述
5. 點擊「部署」

## 📞 技術支援

如果遇到問題：
1. 檢查此文件中的故障排除章節
2. 確認所有設置步驟都已正確完成
3. 檢查瀏覽器開發者工具中的錯誤訊息
4. 檢查 Google Apps Script 的執行記錄 